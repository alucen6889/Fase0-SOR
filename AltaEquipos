Name*Surname*Surname1*Surname2*account*path*dni*Departament*Enabled*Password*ExpirationAccount*email*NetTime*computer*Group




$domain="dc=smr,dc=local"


if (!(Get-Module -Name ActiveDirectory)) #Accederá al then solo si no existe una entrada llamada ActiveDirectory
{
  Import-Module ActiveDirectory #Se carga el módulo
}

$fichero = import-csv -Path $fileUsersCsv -Delimiter *
						     		     
foreach($linea in $ficheroImportado)
{
	
	$passAccount=ConvertTo-SecureString $linea.Password -AsPlainText -force
	$Surnames=$linea.FirstName+' '+$linea.LastName
	$nameLarge=$linea.Name+' '+$linea.FirstName+' '+$linea.LastName
	$email=$linea.Email
	[boolean]$Habilitado=$true
    	If($linea.Enabled -Match 'false') { $Habilitado=$false}
	#Establecer los días de expiración de la cuenta (Columna del csv ExpirationAccount)
   	$ExpirationAccount = $linea.ExpirationAccount
    	$timeExp = (get-date).AddDays($ExpirationAccount)
	
	New-ADUser -SamAccountName $linea.Account -UserPrincipalName $linea.Account -Name $linea.Account `
		-Surname $Surnames -DisplayName $nameLarge -GivenName $linea.Name `
		-Description "Cuenta de $nameLarge" -EmailAddress $email `
		-AccountPassword $passAccount -Enabled $Habilitado `
		-CannotChangePassword $false -ChangePasswordAtLogon $true `
		-PasswordNotRequired $false -Path $linea.Path -AccountExpirationDate $timeExp
  		-LogonWorkstations $linea.computer
		
  

        $horassesion = $linea.NetTime -replace(" ","")
        net user $linea.Account /times:$horassesion 
	

	
	$cnGrpAccount="Cn="+$linea.Group+","+$linea.Path
	Add-ADGroupMember -Identity $cnGrpAccount -Members $linea.Account
	
} 
Write-Host "Se han creado los usuarios correctamente en el dominio $domain" 
